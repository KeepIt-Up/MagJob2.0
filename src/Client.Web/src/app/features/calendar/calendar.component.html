<div class="p-4 dark:bg-gray-900 bg-white text-gray-900 dark:text-gray-200 h-full flex flex-col">
    <!-- Calendar Header -->
    <div class="grid grid-cols-7 pl-16 py-4 sticky top-0 bg-white dark:bg-gray-900 z-20 pb-2">
        <div *ngFor="let day of weekDays; let i = index" class="text-center">
            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">{{dayNames[i]}}</div>
            <div
                [ngClass]="{'bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center mx-auto': i === 2, 'w-8 h-8 flex items-center justify-center mx-auto': i !== 2}">
                {{day}}
            </div>
        </div>
    </div>

    <!-- Time Grid -->
    <div class="relative flex-1 overflow-y-auto">
        <!-- Time labels -->
        <div class="absolute left-0 w-16 bg-white dark:bg-gray-900 z-10">
            @for (hour of hours; track $index) {
            <div class="h-14">
                <span class="text-xs text-gray-500">{{hour}}</span>
            </div>
            }
        </div>

        <!-- Grid lines -->
        <div class="ml-16 grid grid-cols-7 border-l border-gray-200 dark:border-gray-700">
            <div *ngFor="let day of weekDays" class="border-r border-gray-200 dark:border-gray-700 relative">
                <div *ngFor="let hour of hours" class="h-14 border-b border-gray-200 dark:border-gray-700">
                    <div class="grid grid-rows-4 h-full">
                        @for(quarter of [0,1,2,3]; track $index) {
                        <div tabindex="0"
                            class="relative h-full border-b border-gray-200 dark:border-gray-700 border-opacity-30 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800"
                            (mousedown)="startSelection(day, hour, quarter)"
                            (mouseover)="updateSelection(day, hour, quarter)" (mouseup)="endSelection()"
                            (focus)="updateSelection(day, hour, quarter)"
                            (keydown.space)="startSelection(day, hour, quarter)" (keyup.space)="endSelection()"
                            [ngClass]="{'bg-blue-100 dark:bg-blue-600 dark:bg-opacity-50': isSelected(day, hour, quarter)}">

                            <!-- Add the x button -->
                            <button *ngIf="isCorner(day, hour, quarter)"
                                class="absolute p-1 -top-3 -right-2 h-5 border border-black flex items-center justify-center text-xs text-gray-700 dark:text-gray-400 bg-white dark:bg-gray-800 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700"
                                (click)="removeSelectionById(getSelectionId(day, hour, quarter)); $event.stopPropagation()">
                                <span class="sr-only">Remove selection</span>
                                Remove
                            </button>
                        </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>